# PRD: 본문 셀렉터 자동 감지 기능

## 1. 개요

웹 도메인 추가 시 게시글 본문을 추출하기 위한 CSS 셀렉터를 자동으로 감지하고, 사용자가 확인 및 수정할 수 있는 하이브리드 방식을 구현합니다.

## 2. 목표

- 도메인 추가 시 본문 셀렉터를 자동으로 추천하여 사용자 편의성 향상
- 사용자가 직접 확인하고 수정할 수 있어 정확도 보장
- 여러 게시글에 대한 검증 기능으로 신뢰성 확보

## 3. 기능 요구사항

### 3.1 자동 셀렉터 감지

#### 3.1.1 백엔드 API
- **엔드포인트**: `POST /api/analyze-selector`
- **요청 파라미터**:
  - `url`: 분석할 샘플 게시글 URL (필수)
  - `baseUrl`: 도메인 Base URL (선택, 도메인 컨텍스트 제공)
- **응답 데이터**:
  - `candidates`: 셀렉터 후보 목록 (배열)
    - `selector`: CSS 셀렉터 문자열
    - `confidence`: 신뢰도 점수 (0-100)
    - `extractedText`: 해당 셀렉터로 추출된 텍스트 샘플 (미리보기용)
    - `textLength`: 추출된 텍스트 길이
  - `recommended`: 가장 추천되는 셀렉터 (신뢰도가 가장 높은 것)
  - `status`: 성공/실패 상태
  - `error`: 에러 메시지 (실패 시)

#### 3.1.2 감지 알고리즘 요구사항
- 시맨틱 태그 우선순위 적용
  - `article`, `main`, `section` 태그 우선 고려
- 클래스명 패턴 매칭
  - `content`, `post`, `article`, `body`, `main` 등의 키워드 포함 클래스 우선
- 텍스트 길이 기반 필터링
  - 본문으로 추정되는 요소는 일정 길이 이상의 텍스트를 포함해야 함
- 노이즈 요소 제거
  - `aside`, `nav`, `footer`, `header`, `script`, `style` 등 제외
  - 광고 영역, 댓글 영역 등 제외 로직 적용
- 복합 셀렉터 생성
  - 단순 셀렉터뿐만 아니라 `article .content > p` 같은 복합 셀렉터도 고려

### 3.2 프론트엔드 UI/UX

#### 3.2.1 도메인 추가 모달 플로우
1. **기본 정보 입력**
   - 도메인 이름 입력
   - Base URL 입력

2. **사이트 유형 확인**
   - "사이트 유형 확인" 버튼 클릭
   - 동적/정적 사이트 판별 결과 표시

3. **본문 셀렉터 확인** (사이트 유형 확인 후 표시)
   - 샘플 게시글 URL 입력 필드
   - "본문 셀렉터 확인" 버튼 클릭
   - 로딩 상태 표시

4. **자동 감지 결과 표시**
   - 추천 셀렉터를 기본값으로 자동 입력
   - 추천 셀렉터로 추출된 본문 미리보기 표시
   - 여러 후보 셀렉터 목록 표시 (드롭다운 또는 리스트)
     - 각 후보마다 신뢰도 점수 표시
     - 각 후보 선택 시 미리보기 업데이트

5. **셀렉터 수정**
   - 사용자가 직접 셀렉터 입력 가능
   - "적용" 버튼으로 수정된 셀렉터 테스트
   - 수정된 셀렉터로 미리보기 업데이트

6. **셀렉터 확인**
   - "이 셀렉터가 맞습니다" 버튼 클릭
   - 확인 완료 상태로 변경

7. **도메인 추가 완료**
   - 모든 단계 완료 후 "추가" 버튼 활성화

#### 3.2.2 UI 컴포넌트 요구사항
- **셀렉터 후보 목록**
  - 드롭다운 또는 선택 가능한 리스트 형태
  - 각 항목에 신뢰도 점수 표시 (예: "div.content (신뢰도: 95%)")
  - 선택 시 해당 셀렉터로 미리보기 업데이트

- **미리보기 영역**
  - 추출된 본문 텍스트 표시
  - 텍스트가 너무 길 경우 일부만 표시하고 "..." 처리
  - 스크롤 가능한 영역으로 구성

- **로딩 상태**
  - 셀렉터 분석 중 로딩 스피너 또는 진행 표시
  - 분석 완료까지 버튼 비활성화

- **에러 처리**
  - 셀렉터 분석 실패 시 에러 메시지 표시
  - 사용자가 수동으로 셀렉터 입력 가능하도록 유지

### 3.3 검증 기능

#### 3.3.1 추가 검증 URL 테스트
- 같은 도메인의 다른 게시글 URL로 테스트 가능
- "추가 검증" 섹션에 다른 URL 입력 필드 제공
- 입력한 URL에서도 동일한 셀렉터로 본문 추출 시도
- 성공/실패 결과 표시
- 여러 URL로 검증하여 신뢰도 향상

#### 3.3.2 검증 결과 표시
- 각 검증 URL마다 성공/실패 아이콘 표시
- 실패한 경우 추출된 내용 또는 에러 메시지 표시
- 전체 검증 결과 요약 (예: "3개 중 2개 성공")

## 4. 사용자 플로우

### 4.1 정상 플로우
1. 사용자가 도메인 추가 모달 열기
2. 도메인 이름, Base URL 입력
3. "사이트 유형 확인" 클릭 → 결과 확인
4. 샘플 게시글 URL 입력
5. "본문 셀렉터 확인" 클릭
6. 자동 감지된 추천 셀렉터 확인
7. 미리보기로 본문이 올바르게 추출되었는지 확인
8. 필요 시 다른 후보 셀렉터 선택하거나 직접 수정
9. (선택) 추가 검증 URL로 테스트
10. "이 셀렉터가 맞습니다" 클릭
11. "추가" 버튼 클릭하여 도메인 생성

### 4.2 자동 감지 실패 플로우
1. 샘플 게시글 URL 입력
2. "본문 셀렉터 확인" 클릭
3. 자동 감지 실패 또는 신뢰도 낮은 결과 표시
4. 사용자가 직접 셀렉터 입력
5. "적용" 버튼으로 테스트
6. 미리보기 확인 후 확정

### 4.3 셀렉터 수정 플로우
1. 자동 감지된 셀렉터 확인
2. 미리보기에서 본문이 일부만 추출되거나 불필요한 내용 포함 확인
3. "셀렉터 수정" 필드에 새로운 셀렉터 입력
4. "적용" 버튼 클릭
5. 수정된 셀렉터로 미리보기 업데이트
6. 올바른 결과 확인 후 확정

## 5. 기술 요구사항

### 5.1 백엔드
- 샘플 게시글 URL에서 HTML 파싱
- CSS 셀렉터로 요소 선택 및 텍스트 추출
- 여러 후보 셀렉터 생성 및 평가 알고리즘
- 신뢰도 점수 계산 로직
- 동적 사이트의 경우 Selenium 또는 Puppeteer 사용 고려

### 5.2 프론트엔드
- API 호출 및 응답 처리
- 로딩 상태 관리
- 에러 처리 및 사용자 피드백
- 미리보기 UI 컴포넌트
- 셀렉터 후보 목록 UI

### 5.3 성능 요구사항
- 셀렉터 분석 응답 시간: 3초 이내
- 타임아웃 설정: 10초
- 실패 시 재시도 옵션 제공

## 6. 에러 처리

### 6.1 네트워크 에러
- API 호출 실패 시 에러 메시지 표시
- 사용자가 수동으로 셀렉터 입력 가능하도록 유지

### 6.2 URL 접근 불가
- 샘플 게시글 URL에 접근할 수 없는 경우
- 에러 메시지 표시 및 다른 URL 입력 유도

### 6.3 셀렉터 추출 실패
- 자동 감지가 실패한 경우
- 사용자에게 수동 입력 안내
- 기본적인 셀렉터 예시 제공 (예: "article", "div.content")

## 7. 향후 개선 사항

- 머신러닝 기반 셀렉터 추천 정확도 향상
- 도메인별 셀렉터 패턴 학습 및 재사용
- 셀렉터 자동 업데이트 기능 (사이트 구조 변경 감지)
- 여러 샘플 URL을 한 번에 분석하여 더 정확한 셀렉터 추천

## 8. 우선순위

### Phase 1 (필수)
- 기본 자동 감지 API 구현
- 추천 셀렉터 1개 반환
- 미리보기 기능
- 수동 셀렉터 입력 및 수정

### Phase 2 (중요)
- 여러 후보 셀렉터 목록 제공
- 신뢰도 점수 표시
- 추가 검증 URL 테스트 기능

### Phase 3 (선택)
- 검증 결과 상세 분석
- 셀렉터 패턴 학습 및 재사용

