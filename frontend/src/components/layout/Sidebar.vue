<template>
  <aside
    class="fixed top-0 left-0 bg-gray-50 border-r border-gray-200 h-screen flex flex-col transition-all duration-300 z-40"
    :class="isCollapsed ? 'w-14' : 'w-64'"
  >
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
      <div v-if="!isCollapsed">
        <h1 class="text-xl font-bold text-gray-900">ìƒˆì›€ AI</h1>
        <p class="text-sm text-gray-500">í…ŒìŠ¤íŠ¸ê³µê°„</p>
      </div>
      <button
        @click="toggleCollapse"
        class="p-2 rounded-md hover:bg-gray-100 transition"
      >
        <span v-if="isCollapsed">â¡ï¸</span>
        <span v-else>â¬…ï¸</span>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 p-2 overflow-y-auto">
      <!-- ìƒí’ˆ ì‡¼ë£¸ Section -->
      <div class="mb-4">
        <Collapsible v-model:open="showroomOpen">
          <CollapsibleTrigger
            class="flex items-center justify-between w-full p-2 text-left hover:bg-gray-100 rounded-md"
            v-if="!isCollapsed"
          >
            <div class="flex items-center gap-2">
              <span class="text-lg">ğŸ</span>
              <span class="font-semibold text-gray-900">ì‡¼ë£¸</span>
            </div>
            <span class="text-gray-400 text-sm">{{ showroomOpen ? 'â–¼' : 'â–¶' }}</span>
          </CollapsibleTrigger>

          <!-- collapsed ìƒíƒœì¼ ë•ŒëŠ” ì•„ì´ì½˜ë§Œ -->
          <button
            v-else
            @click="showroomOpen = !showroomOpen"
            class="flex items-center justify-center w-full p-2 hover:bg-gray-100 rounded-md"
          >
          ğŸ
          </button>

          <CollapsibleContent v-if="showroomOpen && !isCollapsed" class="mt-2 space-y-1 pl-6">
            <router-link
              v-for="item in showroomItems"
              :key="item.path"
              :to="item.path"
              class="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100 transition-colors"
              :class="{ 'bg-blue-50 text-blue-700 font-medium': isActive(item.path) }"
            >
              <span>{{ item.icon }}</span>
              <span>{{ item.label }}</span>
            </router-link>
          </CollapsibleContent>
        </Collapsible>
      </div>

      <!-- ë°©ê¾¸ Section -->
      <div class="mb-4">
        <Collapsible v-model:open="bangkkuOpen">
          <CollapsibleTrigger
            class="flex items-center justify-between w-full p-2 text-left hover:bg-gray-100 rounded-md"
            v-if="!isCollapsed"
          >
            <div class="flex items-center gap-2">
              <span class="text-lg">ğŸ“¦</span>
              <span class="font-semibold text-gray-900">ë°©ê¾¸</span>
            </div>
            <span class="text-gray-400 text-sm">{{ bangkkuOpen ? 'â–¼' : 'â–¶' }}</span>
          </CollapsibleTrigger>

          <!-- collapsed ìƒíƒœì¼ ë•ŒëŠ” ì•„ì´ì½˜ë§Œ -->
          <button
            v-else
            @click="bangkkuOpen = !bangkkuOpen"
            class="flex items-center justify-center w-full p-2 hover:bg-gray-100 rounded-md"
          >
          ğŸ“¦
          </button>

          <CollapsibleContent v-if="bangkkuOpen && !isCollapsed" class="mt-2 space-y-1 pl-6">
            <router-link
              v-for="item in bangkkuItems"
              :key="item.path"
              :to="item.path"
              class="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100 transition-colors"
              :class="{ 'bg-blue-50 text-blue-700 font-medium': isActive(item.path) }"
            >
              <span>{{ item.icon }}</span>
              <span>{{ item.label }}</span>
            </router-link>
          </CollapsibleContent>
        </Collapsible>
      </div>

      <!-- í—¤ì–´ Section -->
      <div class="mb-4">
        <Collapsible v-model:open="hairOpen">
          <CollapsibleTrigger
            class="flex items-center justify-between w-full p-2 text-left hover:bg-gray-100 rounded-md"
            v-if="!isCollapsed"
          >
            <div class="flex items-center gap-2">
              <span class="text-lg">ğŸ’ˆ</span>
              <span class="font-semibold text-gray-900">í—¤ì–´</span>
            </div>
            <span class="text-gray-400 text-sm">{{ hairOpen ? 'â–¼' : 'â–¶' }}</span>
          </CollapsibleTrigger>

          <button
            v-else
            @click="hairOpen = !hairOpen"
            class="flex items-center justify-center w-full p-2 hover:bg-gray-100 rounded-md"
          >
            ğŸ’ˆ
          </button>

          <CollapsibleContent v-if="hairOpen && !isCollapsed" class="mt-2 space-y-1 pl-6">
            <router-link
              v-for="item in hairItems"
              :key="item.path"
              :to="item.path"
              class="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100 transition-colors"
              :class="{ 'bg-blue-50 text-blue-700 font-medium': isActive(item.path) }"
            >
              <span>{{ item.icon }}</span>
              <span>{{ item.label }}</span>
            </router-link>
          </CollapsibleContent>
        </Collapsible>
      </div>

      <!-- í¬ë¡¤ë§ Section -->
      <div class="mb-4">
        <Collapsible v-model:open="crawOpen">
          <CollapsibleTrigger
            class="flex items-center justify-between w-full p-2 text-left hover:bg-gray-100 rounded-md"
            v-if="!isCollapsed"
          >
            <div class="flex items-center gap-2">
              <span class="text-lg">ğŸ–¥ï¸</span>
              <span class="font-semibold text-gray-900">í¬ë¡¤ë§</span>
            </div>
            <span class="text-gray-400 text-sm">{{ crawOpen ? 'â–¼' : 'â–¶' }}</span>
          </CollapsibleTrigger>

          <button
            v-else
            @click="crawOpen = !crawOpen"
            class="flex items-center justify-center w-full p-2 hover:bg-gray-100 rounded-md"
          >
            ğŸ’ˆ
          </button>

          <CollapsibleContent v-if="crawOpen && !isCollapsed" class="mt-2 space-y-1 pl-6">
            <router-link
              v-for="item in crawItems"
              :key="item.path"
              :to="item.path"
              class="flex items-center gap-2 p-2 text-sm rounded-md hover:bg-gray-100 transition-colors"
              :class="{ 'bg-blue-50 text-blue-700 font-medium': isActive(item.path) }"
            >
              <span>{{ item.icon }}</span>
              <span>{{ item.label }}</span>
            </router-link>
          </CollapsibleContent>
        </Collapsible>
      </div>

      <!-- ì• ë‹ˆí†¡ Section -->
      <div class="mb-4">
        <button
          v-if="!isCollapsed"
          @click="handleComingSoon('ì• ë‹ˆí†¡')"
          class="flex items-center justify-between w-full p-2 text-left hover:bg-gray-100 rounded-md opacity-60 cursor-not-allowed"
        >
          <div class="flex items-center gap-2">
            <span class="text-lg">ğŸ“±</span>
            <span class="font-semibold text-gray-900">ì• ë‹ˆí†¡</span>
          </div>
          <Badge variant="secondary" class="text-xs">Soon</Badge>
        </button>

        <!-- Collapsed ëª¨ë“œì—ì„œëŠ” ì•„ì´ì½˜ë§Œ -->
        <button
          v-else
          @click="handleComingSoon('ì• ë‹ˆí†¡')"
          class="flex items-center justify-center w-full p-2 hover:bg-gray-100 rounded-md opacity-60 cursor-not-allowed"
        >
          ğŸ“±
        </button>
      </div>

      <!-- BAIK Section -->
      <div class="mb-4">
        <button
          v-if="!isCollapsed"
          @click="handleComingSoon('BAIK')"
          class="flex items-center justify-between w-full p-2 text-left hover:bg-gray-100 rounded-md opacity-60 cursor-not-allowed"
        >
          <div class="flex items-center gap-2">
            <span class="text-lg">ğŸ¤–</span>
            <span class="font-semibold text-gray-900">BAIK</span>
          </div>
          <Badge variant="secondary" class="text-xs">Soon</Badge>
        </button>

        <button
          v-else
          @click="handleComingSoon('BAIK')"
          class="flex items-center justify-center w-full p-2 hover:bg-gray-100 rounded-md opacity-60 cursor-not-allowed"
        >
          ğŸ¤–
        </button>
      </div>
    </nav>

    <!-- Footer -->
    <div
      class="p-4 border-t border-gray-200 text-xs text-gray-500"
      v-if="!isCollapsed"
    >
      Â© 2025 ìƒˆì›€ì†Œí”„íŠ¸
    </div>
  </aside>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue';
import { useRoute } from 'vue-router';
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';
import { Badge } from '@/components/ui/badge';

const route = useRoute();
const showroomOpen = ref(true);
const bangkkuOpen = ref(true);
const hairOpen = ref(true);
const crawOpen = ref(true);
const isCollapsed = ref(false);
const isMobile = ref(false);

const emit = defineEmits(['update:isCollapsed']);

const showroomItems = [
  { path: '/showroom/showroom-generator', label: 'ìƒí’ˆ ì‡¼ë£¸ ìƒì„±', icon: 'ğŸ–¼ï¸' }
];

const bangkkuItems = [
  { path: '/bangkku/furniture-removal', label: 'ê°€êµ¬ ì œê±°', icon: 'ğŸ›‹ï¸' },
  { path: '/bangkku/furniture-front-view', label: 'ê°€êµ¬ ë“œë˜ê·¸ ì´ë¯¸ì§€ë¡œ ë³€í™˜', icon: 'ğŸ–¼ï¸' },
  { path: '/bangkku/3d-room-generator', label: '3D ë£¸ ìƒì„±', icon: 'ğŸ ' },
  { path: '/bangkku/video-generation', label: 'ë¹„ë””ì˜¤ ìƒì„±', icon: 'ğŸ¬' },
];

const hairItems = [
  { path: '/hair/hair-generator', label: 'í—¤ì–´ ìŠ¤íƒ€ì¼ ìƒì„±', icon: 'ğŸ’ˆ' },
  { path: '/hair/video-generation', label: 'ë¹„ë””ì˜¤ ìƒì„±', icon: 'ğŸ¬' },
];
const crawItems = [
  { path: '/craw/crawling', label: 'ê³µì§€ì‚¬í•­ í¬ë¡¤ë§', icon: 'ğŸ–¥ï¸' }
];

const isActive = (path: string) => route.path === path;

const toggleCollapse = () => {
  isCollapsed.value = !isCollapsed.value;
  emit('update:isCollapsed', isCollapsed.value);
};

const handleResize = () => {
  isMobile.value = window.innerWidth < 768;
  isCollapsed.value = isMobile.value;
  emit('update:isCollapsed', isCollapsed.value);
};

const handleComingSoon = (serviceName: string) => {
  alert(`${serviceName} ì„œë¹„ìŠ¤ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
};

onMounted(() => {
  handleResize();
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  window.removeEventListener('resize', handleResize);
});
</script>
